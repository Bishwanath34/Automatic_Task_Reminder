<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Task Reminder App</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/index.css}">

</head>

<body>

<!-- ===== HEADER ===== -->
<!-- ===== HEADER ===== -->
<div class="page-header">

    <!-- LEFT : TITLE -->
    <div class="header-title-left">
        ‚è∞ Task Reminder App
    </div>

    <!-- CENTER : ICONS -->
    <div class="header-icons-center">
        <a th:href="@{/api/cal}" title="Calendar View"><i class="fa-solid fa-calendar"></i></a>
        <a th:href="@{/api/grid}" title="Grid View"><i class="fa-solid fa-table-cells"></i></a>
    </div>

    <!-- RIGHT : CLOCK + USER -->
    <div class="header-icons-right">
        <span id="clock" class="header-clock"></span>
        <span th:text="${loggedUser != null} ? 'Welcome! ' + ${loggedUser.email} : 'Guest'"></span>
        <a th:href="@{/logout}" class="logout-btn">
            <i class="fa-solid fa-right-from-bracket"></i> Logout
        </a>
    </div>

</div>

<!-- ===== FILTER + ADD BUTTON ===== -->
<div class="filter-card mx-2">
    <form th:action="@{/api/tasks}" method="get" class="d-flex flex-wrap gap-2 align-items-end w-100">

        <div>
            <label>Status</label>
            <select name="status" class="form-select">
                <option value="">All</option>
                <option value="PENDING" th:selected="${param.status=='PENDING'}">Pending</option>
                <option value="IN_PROGRESS" th:selected="${param.status=='IN_PROGRESS'}">In Progress</option>
                <option value="COMPLETED" th:selected="${param.status=='COMPLETED'}">Completed</option>
            </select>
        </div>

        <div>
            <label>Priority</label>
            <select name="priority" class="form-select">
                <option value="">All</option>
                <option value="LOW" th:selected="${param.priority=='LOW'}">Low</option>
                <option value="MEDIUM" th:selected="${param.priority=='MEDIUM'}">Medium</option>
                <option value="HIGH" th:selected="${param.priority=='HIGH'}">High</option>
            </select>
        </div>

        <div>
            <label>Sort By</label>
            <select name="sortBy" class="form-select">
                <option value="id" th:selected="${param.sortBy==null || param.sortBy=='id'}">ID</option>
                <option value="dueDate" th:selected="${param.sortBy=='dueDate'}">Due Date</option>
                <option value="priority" th:selected="${param.sortBy=='priority'}">Priority</option>
                <option value="title" th:selected="${param.sortBy=='title'}">Title</option>
                <option value="createdAt" th:selected="${param.sortBy=='createdAt'}">Created At</option>
                <option value="completedAt" th:selected="${param.sortBy=='completedAt'}">Completed At</option>
            </select>
        </div>

        <div>
            <label>Keyword</label>
            <input type="text" name="keyword" class="form-control" placeholder="Search..." th:value="${param.keyword}">
        </div>

        <div class="action-group">
            <button class="btn btn-primary">Apply</button>
            <a th:href="@{/api/tasks(pageNo=0,pageSize=5,sortBy=id)}" class="btn btn-outline-secondary">Clear</a>
            <a th:href="@{/api/}" class="btn btn-outline-secondary">Add Task</a>
        </div>

    </form>
</div>

<!-- ===== TASK TABLE ===== -->
<div class="table-container mx-2">
    <table class="table table-striped table-hover table-bordered">
        <thead>
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Description</th>
            <th>Due Date</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Created At</th>
            <th>Completed At</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="task : ${tasks}">
            <td th:text="${task.id}"></td>
            <td th:text="${task.title}"></td>
            <td th:text="${task.description}"></td>
            <td th:text="${task.dueDate}"></td>
            <td th:text="${task.priority}"></td>
            <td th:text="${task.status}"></td>
            <td th:text="${task.createdAt}"></td>
            <td th:text="${task.completedAt}"></td>
            <td>
                <div class="d-flex justify-content-center gap-1">
                    <a th:href="@{/api/view/{id}(id=${task.id})}" class="btn btn-sm btn-primary">View</a>
                    <a th:href="@{/api/form/{id}(id=${task.id})}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="javascript:void(0);" class="btn btn-sm btn-danger"
                       th:onclick="|confirmDelete('/api/task/${task.id}')|">Delete</a>
                    <a th:href="@{/api/taskUpdate/{id}(id=${task.id})}" class="btn btn-sm btn-success">Done</a>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- ===== PAGINATION ===== -->
<nav class="mx-2">
    <ul class="pagination justify-content-center">
        <li class="page-item" th:classappend="${currentPage==0} ? 'disabled'">
            <a class="page-link"
               th:href="@{/api/tasks(pageNo=${currentPage-1},pageSize=${pageSize},sortBy=${param.sortBy},status=${param.status},priority=${param.priority},keyword=${param.keyword})}">
                Previous
            </a>
        </li>
        <li class="page-item" th:each="i : ${#numbers.sequence(0,totalPages-1)}"
            th:classappend="${i==currentPage} ? 'active'">
            <a class="page-link"
               th:href="@{/api/tasks(pageNo=${i},pageSize=${pageSize},sortBy=${param.sortBy},status=${param.status},priority=${param.priority},keyword=${param.keyword})}"
               th:text="${i+1}"></a>
        </li>
        <li class="page-item" th:classappend="${currentPage==totalPages-1} ? 'disabled'">
            <a class="page-link"
               th:href="@{/api/tasks(pageNo=${currentPage+1},pageSize=${pageSize},sortBy=${param.sortBy},status=${param.status},priority=${param.priority},keyword=${param.keyword})}">
                Next
            </a>
        </li>
    </ul>
</nav>

<!-- ===== FOOTER ===== -->
<footer>
    Task Reminder App ¬© 2025 ‚Äî Created by Bishwanath Kumam
</footer>

<!-- ===== SCRIPTS ===== -->
<script>
    function confirmDelete(url) {
        if (confirm("Are you sure you want to delete this task?")) {
            window.location.href = url;
        }
    }
    function updateClock() {
        const now = new Date();
        const time = now.toLocaleTimeString();
        document.getElementById("clock").innerText = "üïí " + time;
    }

    setInterval(updateClock, 1000);
    updateClock();
</script>

</body>
</html>
